{% extends "base.html" %}

{% block content %}
  <div id="left-column">
    <ul id="local-nav">
      <li><a href="{% url members %}">Members</a></li>
      <li class="last-item"><a class="active" href="{% url accounts %}">Accounts</a></li>
    </ul>
    <div id="primary-content-wrapper">
      <h2>Account Profile</h2>
      <div class="profile {% if not account.active_member_count %}profile-inactive{% endif %}">
        <div class="profile-links">
          <h5>Members ({{ account.active_member_count }} active)</h5>
          <ul>
            {% for am in account.accountmember_set.all %}
              <li><a href="{% url member am.member.user.username %}">{{ am.member }}</a>{% ifnotequal am.member.status "a" %} ({{ am.member.status }}){% endifnotequal %}{% if am.shopper %} (S){% endif %}</li>
            {% endfor %}
          </ul>
        </div>
        <h4>
          {% if user.is_staff %}	
          <a href="{% url account-edit account.id %}">edit</a>
          {% endif %}
          {{ account }}
        </h4>
        <ul class="quick-info">
          <li>
            <img src="{{ MEDIA_URL }}images/twotiny/icon-question-mark.gif" alt="Can Shop"/> 
            {{ account.can_shop }}
          </li>
          <li>
            <img src="{{ MEDIA_URL }}images/twotiny/icon-clipboard.gif" alt="Contact"/> 
            {% for am in account.accountmember_set.all %}
              {% if am.account_contact %}
            <a href="{% url member am.member.user.username %}">{{ am.member }}</a>
              {% endif %}
            {% endfor %}
          </li>
          <li>
            <img src="{{ MEDIA_URL }}images/twotiny/icon-calendar.gif" alt="Balance"/> 
            {{ account.balance|floatformat:2 }}
          </li>
        </ul>
        <div class="details">
          <h5>Account Notes</h5>
          {{ account.note|linebreaks }}
        </div>
        <div id="transactions">
          <h2>Transaction Log</h2>
          <table class="data" >
            <tr>
              <th>ID</th>
              <th>Time</th>
              <th>Member</th>
              <th>Note</th>
              <th>Purchase Type</th>
              <th>Purchase Amount</th>
              <th>Payment Type</th>
              <th>Payment Amount</th>
              <th>Account Balance</th>
            </tr>
            {% for transaction in transactions|dictsortreversed:"id" %}
            <tr class="{% cycle 'odd' 'even' %}" >
              <td>{{ transaction.id }}</td>
              <td class="nowrap">{{ transaction.timestamp|date:"g:i:s A" }}</td>    
              <td>{{ transaction.member.user.get_full_name }}</td>
              <td>{{ transaction.note }}</td>
              <td>{{ transaction.get_purchase_type_display }}</td>
              <td>{{ transaction.purchase_amount|floatformat:2 }}</td>
              <td>{{ transaction.get_payment_type_display }}</td>
              <td>{{ transaction.payment_amount|floatformat:2 }}</td>
              <td>{{ transaction.account.balance|floatformat:2 }}</td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
  </div>
  <div id="right-column">
    <h3>Icon Key</h3>
    <ul id="icon-key">
      <li><img src="{{ MEDIA_URL }}images/twotiny/icon-question-mark.gif"/> Can Shop</li>
      <li><img src="{{ MEDIA_URL }}images/twotiny/icon-clipboard.gif"/> Contact</li>
      <li><img src="{{ MEDIA_URL }}images/twotiny/icon-calendar.gif"/> Balance</li>
      {# FIXME should hide statuses not in use on this page #}
<!--      <li>(a) Active</li> -->
      <li>(L) Leave of Absence</li>
      <li>(m) Missing</li>
      <li>(x) Missing Delinquent</li>
      <li>(d) Departed</li>
      <li>(S) Proxy Shopper</li>
    </ul>

    <h3 id="task_future_title">Next Workshift(s) +/-</h3>
      <table class="acctwork">
        {% for member in account.members.all %}
          {% ifequal member.work_status "e" %}
            <tr><td class="task-exempt">{{ member }}: Exempt</td></tr>
          {% endifequal %}
          {% ifequal member.work_status "c" %}
            <tr><td class="task-committee">{{ member }}: Committee or other Non-Shift work</td></tr>
          {% endifequal %}
        {% endfor %}
        {% for task in tasks %}
          <tr><td class="{% if task.excused %}task-excused {% endif %}{% if task.makeup %}task-makeup {% endif %}{% if task.banked %}task-banked {% endif %}">
            {{ task.member }} &mdash; {{ task.job }} <br>
            <a href="{% url scheduling-schedule task.time|date:"Y-m-d" %}">{{ task.time|date:"D n/j/y" }}</a>, {{ task.time|time:"g:ia" }}, {{ task.hours }} hours <br>
            {% if task.excused %}<b>Excused</b>{% endif %}
            {% if task.makeup %}<b>Makeup</b>{% endif %}
            {% if task.banked %}<b>Banked</b>{% endif %}
          </td></tr>
          {% if forloop.first %}
            </table>
            <table class="acctwork" id="task_future_table">
          {% endif %}
        {% endfor %}
      </table>
      <script>task_future_hide();</script>

    <h3>Work History</h3>
      <table class="acctwork">
        {% for task in pasttasks %}
          <tr><td class="{% if task.unexcused %}task-unexcused {% endif %}{% if task.excused %}task-excused {% endif %}{% if task.makeup %}task-makeup {% endif %}{% if task.banked %}task-banked {% endif %}">
            {{ task.member }} &mdash; {{ task.job }} <br>
            <a href="{% url scheduling-schedule task.time|date:"Y-m-d" %}">{{ task.time|date:"D n/j/y" }}</a>, {{ task.time|time:"g:ia" }}, {{ task.hours }} hours <br>
            {% if task.hours_worked %}<b>Worked {{ task.hours_worked }} hours</b>{% endif %}
            {% if task.unexcused %}<b>Unexcused</b>{% endif %}
            {% if task.excused %}<b>Excused</b>{% endif %}
            {% if task.makeup %}<b>Makeup</b>{% endif %}
            {% if task.banked %}<b>Banked</b>{% endif %}
          </td></tr>
        {% endfor %}
      </table>
  </div>
{% endblock %}
