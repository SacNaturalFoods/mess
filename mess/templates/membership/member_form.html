{% extends "membership/base.html" %}

{% block head %}
  <script type="text/javascript" src="http://yui.yahooapis.com/combo?2.5.2/build/yahoo-dom-event/yahoo-dom-event.js&2.5.2/build/calendar/calendar-min.js&2.5.2/build/connection/connection-min.js"></script>
  <script src="http://yui.yahooapis.com/2.5.2/build/animation/animation-min.js" type="text/javascript"></script> 
  <script type="text/javascript">
    function addNew(formsetPrefix, baseURL, height) {
      var totalForms = document.getElementById('id_' + formsetPrefix + '-TOTAL_FORMS');
      var sUrl = baseURL + '?index=' + totalForms.value;
      totalForms.value = parseInt(totalForms.value) + 1;
      var callback = {
        success: function(o) {
          var newFieldsTable = document.createElement('table');
          newFieldsTable.innerHTML = o.responseText;
          var newFields = document.createElement('div');
          newFields.className = 'added';
          newFields.appendChild(newFieldsTable);
          var writeRoot = document.getElementById(o.argument[0] + '-writeroot');
          writeRoot.parentNode.insertBefore(newFields, writeRoot);
          newFields = writeRoot.previousSibling;
          var addAnim = new YAHOO.util.Anim(newFields, 
            {height: {to: height}}, 1, YAHOO.util.Easing.easeIn);
          addAnim.animate();
          addAnim.onComplete.subscribe(function() {
            newFields.getElementsByTagName('select')[0].focus()
          });
        },
        failure: function(o) {},
        argument: [formsetPrefix],
      };
      var transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback, null);
    }
    //function 
  </script>
{% endblock %}

{% block content %}
  <div id="left-column">
    <div id="primary-content-wrapper">
      <h2>Members</h2>
      <h3>Edit Profile: {{ member.user.get_full_name }} 
	  	({{ member.user.username }})</h3>
      {% if member %}
      {% endif %}
      <form class="standard" method="post">
        <div class="section">
          <h4>Main</h4>
          <table>
            {{ user_form }}
            {{ member_form }}
          </table>
        </div>
        {% for formset, header in formsets %}
        <div class="section">
          <h4>{{ header }}</h4>
          {{ formset.management_form }}
            {% for form in formset.forms %}
          <table>
            {{ form }}
          </table>
              {% if forloop.last %}
          <table id="{{ formset.prefix }}-writeroot" class="add">
            <tr>
              <th>Add:</th>
              <td>
                <input type="checkbox" onclick="addNew('{{ formset.prefix }}', '{% url profiles-form formset.prefix %}', {% ifequal formset.prefix 'address' %}400{% else %}100{% endifequal %}); this.checked = false;" id="{{ formset.prefix }}-add" />
              </td>
            </tr>
          </table>
        </div>
              {% endif %}
            {% endfor %}
          {% endfor %}
        <table>
          <tr><th></th><td><input type="submit" class="button" value="Save"/></td></tr>
        </table>
      </form>
    </div>
  </div>
  <div id="right-column">
    Content here.
  </div>
{% endblock %}

{% block pop_up %}
<div id='message' onclick='hide_message ()' ></div>
<div id=list ></div>
<div id=listShadow ></div>
{% endblock %}
