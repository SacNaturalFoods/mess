{% extends "membership/base.html" %}

{% block head %}
  <script type="text/javascript" src="http://yui.yahooapis.com/combo?2.5.2/build/yahoo-dom-event/yahoo-dom-event.js&2.5.2/build/calendar/calendar-min.js&2.5.2/build/connection/connection-min.js"></script>
  <script type="text/javascript">
    function addNew(formsetPrefix, baseURL) {
      var totalForms = document.getElementById('id_' + formsetPrefix + '-TOTAL_FORMS');
      var sUrl = baseURL + '?index=' + totalForms.value;
      totalForms.value = parseInt(totalForms.value) + 1;
      var callback = {
        success: function(o) {
          var newFields = document.createElement('table');
          newFields.innerHTML = o.responseText;
          var writeRoot = document.getElementById(o.argument[0] + '-writeroot');
          writeRoot.parentNode.insertBefore(newFields, writeRoot);
          writeRoot.previousSibling.getElementsByTagName('select')[0].focus()
        },
        failure: function(o) {},
        argument: [formsetPrefix],
      };
      var transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback, null);
    }
  </script>
{% endblock %}

{% block content %}
  <div id="left-column">
    <div id="primary-content-wrapper">
      <h2>Members</h2>
      <h3>Edit Profile: {{ member.user.get_full_name }} 
	  	({{ member.user.username }})</h3>
      {% if member %}
      {% endif %}
      <form class="standard" method="post">
        <table>
          {{ user_form }}
          {{ member_form }}
        </table>
        {% for formset, header in formsets %}
        <h4 class="section">{{ header }}</h4>
          {{ formset.management_form }}
          {% for form in formset.forms %}
          <table>
            {{ form }}
          </table>
            {% if forloop.last %}
          <table id="{{ formset.prefix }}-writeroot" class="add">
            <tr>
              <th></th>
              <td>
                <a onclick="addNew('{{ formset.prefix }}', '{% url profiles-form formset.prefix %}'); return false;" id="{{ formset.prefix }}-add" href="{% url add_contact member.user.username,formset.prefix %}">Add</a>
              </td>
            </tr>
          </table>
            {% endif %}
          {% endfor %}
        {% endfor %}
        <table>
          <tr><th></th><td><input type="submit" class="button" value="Save"/></td></tr>
        </table>
      </form>
    </div>
  </div>
  <div id="right-column">
    Content here.
  </div>
{% endblock %}

{% block pop_up %}
<div id='message' onclick='hide_message ()' ></div>
<div id=list ></div>
<div id=listShadow ></div>
{% endblock %}
