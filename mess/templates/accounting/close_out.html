{% extends "base.html" %}
{% block head %}
  <script type="text/javascript" src="{{ MEDIA_URL }}js/closeout.js"></script>
{% endblock head %}

{% block content %}
  <div id="double-column" >
    {% include "accounting/snippets/page_menu.html" %}
    <div id="primary-content-wrapper">
      <h2>Close Out for {{ date|date:"l, F j, Y" }}</h2>

      <!-- hidden form used by js -->
      <form id="closeoutfixform" method="POST">
        {{ closeoutfixform }}
      </form>

      <table class="data">
        <tr>
          {% for column in columns %}
            <th>{{ column.type }}</th>
          {% endfor %}
        </tr>
        <tr>
          {% for column in columns %}
            <td>
              <p>Total: {{ column.total|floatformat:"2" }}</p>
              <table class="closeout">
                {% for trans in column.transactions %}
                  {% if not trans.fixes_target %}
                  <tr>
                    <td>{{ trans.timestamp|time:"g:i" }}</td>
                    <td><a href="{{ trans.account.get_absolute.url }}">{{ trans.account }}</a></td>
                    <td>{{ trans.fixed_payment_amount|floatformat:"2" }}{% if trans.note %}<span title="{{ trans.note }}">*</span>{% endif %}</td>
                    <td><input type="button" value="fix{% if trans.fixers %}ed{% endif %}" onclick="fixit({{ trans.id }}, '{{ trans.fixed_payment_amount|floatformat:"2" }}', '{{ trans.account }}');"></td>
                  </tr>
                  {% endif %}
                {% endfor %}
              </table>
            </td>
          {% endfor %}
        </tr>
      </table>
      <form action="/" method="GET" onsubmit="return confirm('Thank you!');">
        <input type="submit" value="Complete">
      </form>
    </div>
  </div>
{% endblock %}
